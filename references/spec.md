# repo2doc Specification

## 1. Output contract

Output root: `Report/<ProjectName>/`

Required files:
- `00-reading-guide.md`
- `project-overview.md`
- `getting-started.md`
- `feature-summary.md`
- `<module-name>.md` (one or more)

## 2. Documentation intent

Output must be project documentation for engineers, not a process report.

Rules:
- Do not include tool execution traces in final docs.
- Do not include phrases like "generated by skill/script".
- Keep wording project-centric and implementation-centric.

## 3. Module document contract

Each module document must contain:
- module positioning
- feature summary
- independent feature chapters (`功能点：...`)

Each feature chapter must contain:
1) `实现细节`
2) `设计原理`
3) `关键代码片段`
4) `涉及模块`

### Module subsection contract (under `涉及模块`)

Each involved module must be documented as an independent subsection:
- Heading: `#### 模块：<module-name>`
- Must include four required elements:
  - **职责**: Specific responsibility in this feature context
  - **实现细节**: How it cooperates to implement the feature (interfaces, data flow, state changes)
  - **设计原理**: Design decisions and trade-offs
  - **协作关系**: Call/callee relationships with other modules, data flow direction
- Optional: module-level code snippets

Example:
```markdown
#### 模块：network

- **职责**：负责底层网络连接的管理

- **实现细节**：
  - 使用 `Connector` trait 抽象不同传输协议
  - 连接池管理活跃连接

- **设计原理**：
  - 采用 trait 抽象而非枚举，便于扩展新协议

- **协作关系**：
  - 被 `PeerManager` 调用创建新连接
  - 与 `crypto` 模块协作完成加密传输
```

## 4. Depth profile

### standard
- module docs >= 1
- feature chapters per module doc >= 2
- code snippets not strictly required
- module subsection completeness not strictly enforced

### audit
- module docs >= 2
- feature chapters per module doc >= 3
- strict mode requires code snippets for each feature chapter
- strict mode requires module breakdown under each feature chapter
- **strict mode requires each `模块：...` subsection to have `实现细节` and `设计原理`**

## 5. Validation checks

Validation should check:
- required files
- empty/template-like docs
- module doc count
- feature chapter count
- required headings in feature chapters
- module breakdown in feature chapters (`涉及模块` + `模块：...`)
- **module subsection completeness (职责/实现细节/设计原理/协作关系)**
- process/tool trace text in docs

## 6. Writing quality

- Use concise and accurate technical writing.
- Explain both implementation details and design rationale.
- Keep structure stable for incremental updates.
- Each module subsection must have substantive content for all four required elements.
